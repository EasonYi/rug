
import {TreeNode,ParentAwareTreeNode} from "./PathExpression"

/**
 * Helper functions for working with TreeNodes in simple
 * case where we don't need a path expression.
 */
export class TreeHelper {

    /**
     * Return an ancestor meeting the given criteria
     * or null if it cannot be found
     */
    findAncestor<N extends TreeNode>(n: ParentAwareTreeNode, nodeTest: (N) => boolean): N {
        let parent = n.parent() as any // Makes checking for parent function later easy
        if (parent == null) {
            return null
        }
        else if (nodeTest(parent)) {
            //console.log(`Gotcha: Parent is ${parent}`)
            return parent as N
        }
        else if (parent.parent()) { // Essentially an instanceof, which we can't do on an interface
            return this.findAncestor(parent as ParentAwareTreeNode, nodeTest) as N
        }
        else 
            return null
    }

    /**
     * Find an ancestor with a given tag
     */
    findAncestorWithTag<N extends TreeNode>(n: ParentAwareTreeNode, tag: String): N {
        let r = this.findAncestor<N>(
            n, 
            n => n.nodeTags().contains(tag))
        //console.log(`findAncestorWithTag returning ${r.nodeName()}`)
        return r
    }
}